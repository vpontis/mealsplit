<% provide(:onload_js, "setup_tip_buttons();") %>

<div id="mealSummaryContainer" class="container">

  <div id="mealSummaryHeaderRow" class="row">
    <div id="mealSummaryHeaderColumn" class="col-md-12">
      <h1>Confirm Meal Details</h1>
    </div>
  </div>
  <div id="mealSummaryDetailsRow" class="row">
    <div id="mealSummaryDetailsColumn" class="col-md-6 col-md-offset-3">
      <h3>Restaurant:</h3>
      <p><%= @restaurant.name %></p>

      <h3>Participants:</h3>
      <% @meal.participants.each do |participant| %>
        <div class="mealSummaryParticipantDetailsDiv">
          <h4><%= participant.email %></h4>
          <h5>Items:</h5>
          <% participant.food_items.each do |item| %>
            <p><%= item.name %>: <%= item.cost_pretty %></p>
          <% end %>
          <p>Items Total: <%= number_to_currency(participant.subtotal.to_f/100, :unit => "$") %></p>
          <p>Tax: <%= number_to_currency(participant.tax.to_f/100, :unit => "$") %></p>
          <% tip = (@meal.tip_percent.to_f/100)*(participant.subtotal.to_f/100) %>
          <p>Tip: <%= number_to_currency(tip, :unit => "$") %>
          <p><b>Total: <%= number_to_currency(participant.total.to_f/100+tip) %></b></p>
          <% if !participant.payer %>
            <p>Request will be sent to: <%= participant.email %>.</p>
          <% end %>
          <%= button_to "Edit "+participant.email+"'s Order", edit_meal_participant_path(@meal, participant),
            { :method => "get", :class => "btn" } %>
        </div>
      <% end %>
    </div>
  </div>

  <div id="mealSummarySubmitRow" class="row">
    <div id="mealSummarySubmitColumn" class="col-md-6 col-md-offset-3">
      <%= form_tag(meal_path+"/complete_meal", html: {role: 'form', class: 'form-group'}, method: "post") do %>
        <div class="form-group">
          <%= label_tag(:tip_percent) %>
          <%= hidden_field :meal, :tip_percent, value: 0 %>
          <div id="tip-percent-input" class="btn-group">
            <span class="btn btn-default active" data-value="0">0</span>
            <span class="btn btn-default" data-value="10">10</span>
            <span class="btn btn-default" data-value="15">15</span>
            <span class="btn btn-default" data-value="20">20</span>
          </div>
        </div>
        <%= submit_tag("Send Payment Requests", class: "btn btn-primary") %>
      <% end %>
    </div>
  </div>
</div>
